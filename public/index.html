<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Classifier Arena – Coop Edition</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { font-family: "Poppins", sans-serif; background:#f9fafc; text-align:center; margin:0; }
  header { background:#007acc; color:white; padding:1em; font-size:1.4em; }
  .container { max-width:800px; margin:auto; padding:1em; }
  .card { background:white; border-radius:10px; padding:1em; margin:1em 0; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  button { padding:.8em 1.5em; margin:.5em; border:none; border-radius:8px; cursor:pointer; font-weight:600;}
  .train {background:#4caf50; color:white;} .predict {background:#007acc; color:white;}
  #leaderboard {text-align:left; margin-top:1em;}
</style>
</head>
<body>
<header>🏟️ Classifier Arena – Coop Edition</header>
<div class="container">

  <div class="card" id="joinCard">
    <h3>Inserisci il tuo nome per iniziare:</h3>
    <input type="text" id="username" placeholder="Nome giocatore"/>
    <button onclick="joinGame()">🚀 Entra</button>
  </div>

  <div id="gameArea" style="display:none;">

    <div class="card">
      <h3>⚙️ Addestra il tuo modello</h3>
      <label>Feature:</label><br>
      <input type="checkbox" value="eta"> Età
      <input type="checkbox" value="genere"> Genere
      <input type="checkbox" value="reddito"> Reddito
      <input type="checkbox" value="esperienza"> Esperienza
      <input type="checkbox" value="zona"> Zona
      <input type="checkbox" value="titolo"> Titolo
      <br><br>

      <select id="modelType">
        <option value="tree">Decision Tree</option>
        <option value="logreg">Logistic Regression</option>
      </select>

      <p>Soglia decisionale:
        <input type="range" id="threshold" min="0.1" max="0.9" step="0.1" value="0.5">
        <span id="thVal">0.5</span>
      </p>
      <button class="train" onclick="trainModel()">🏋️ Addestra</button>
      <p id="modelMetrics">🎯 Accuracy: -% | ⚖️ Fairness: -% | ⭐ Score: -</p>
    </div>

    <div class="card">
      <h3>🧩 Caso da classificare</h3>
      <p id="caseData">---</p>
      <button class="predict" onclick="requestCase()">🎲 Nuovo caso</button><br>
      <button onclick="predict(1)">✅ Assumere</button>
      <button onclick="predict(0)">❌ Non assumere</button>
      <p id="predictionResult"></p>
    </div>

    <div class="card">
      <h3>🏆 Classifica</h3>
      <div id="leaderboard"></div>
    </div>
  </div>
</div>

<script>
const socket = io();
let currentCase = null;

function joinGame(){
  const name = document.getElementById("username").value.trim();
  if(!name) return alert("Inserisci un nome!");
  document.getElementById("joinCard").style.display="none";
  document.getElementById("gameArea").style.display="block";
  socket.emit("joinGame", name);
}

function trainModel(){
  const features = Array.from(document.querySelectorAll('input[type=checkbox]:checked')).map(c=>c.value);
  const model_type = document.getElementById("modelType").value;
  const threshold = parseFloat(document.getElementById("threshold").value);
  socket.emit("trainModel", { features, model_type, threshold });
}

socket.on("modelReady", data=>{
  document.getElementById("modelMetrics").innerText =
    `🎯 Accuracy: ${data.accuracy}% | ⚖️ Fairness: ${data.fairness_gap}% | ⭐ Score: ${data.ethical_score}`;
});

socket.on("modelError", err=>alert(err.message));

function requestCase(){ socket.emit("requestCase"); }

socket.on("newCase", data=>{
  currentCase = data;
  document.getElementById("caseData").innerText =
    `Età: ${data.eta}, Genere: ${data.genere}, Reddito: ${data.reddito}€, Esperienza: ${data.esperienza} anni, Zona: ${data.zona}, Titolo: ${data.titolo}`;
});

function predict(user_pred){
  if(!currentCase) return alert("Nessun caso attivo!");
  socket.emit("predictCase", { ...currentCase, user_pred });
}

socket.on("predictionFeedback", d=>{
  document.getElementById("predictionResult").innerText = d.feedback;
});

socket.on("leaderboard", data=>{
  document.getElementById("leaderboard").innerHTML =
    data.map(u=>`<div>${u.name}: ${u.score} punti</div>`).join("");
});
</script>
</body>
</html>
